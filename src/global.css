@import 'tailwindcss';

/* ==========================================
   LAYER 1: PRIMITIVE COLORS (Brand Palette)
   ========================================== */
:root {
  /* Blue Brand Primitives */
  --primitive-blue-400: 96 165 250;
  --primitive-blue-500: 59 130 246;
  --primitive-blue-600: 37 99 235;

  /* Slate Neutral Primitives */
  --primitive-slate-50: 248 250 252;
  --primitive-slate-100: 241 245 249;
  --primitive-slate-200: 226 232 240;
  --primitive-slate-300: 203 213 225;
  --primitive-slate-400: 148 163 184;
  --primitive-slate-500: 100 116 139;
  --primitive-slate-600: 71 85 105;
  --primitive-slate-700: 51 65 85;
  --primitive-slate-800: 30 41 59;
  --primitive-slate-900: 15 23 42;
  --primitive-slate-950: 2 6 23;

  /* Feedback Primitives */
  --primitive-green-500: 34 197 94;
  --primitive-yellow-500: 250 204 21;
  --primitive-red-500: 239 68 68;
  --primitive-red-600: 220 38 38;

  /* ==========================================
     LAYER 2: SEMANTIC TOKENS (Purpose-Based)
     ========================================== */

  /* Surface Colors */
  --color-bg-primary: var(--primitive-slate-50);
  --color-bg-secondary: var(--primitive-slate-100);
  --color-bg-tertiary: var(--primitive-slate-200);
  --color-bg-quaternary: var(--primitive-slate-300);

  /* Text Colors */
  --color-text-primary: var(--primitive-slate-950);
  --color-text-secondary: var(--primitive-slate-600);
  --color-text-tertiary: var(--primitive-slate-500);
  --color-text-inverse: 255 255 255;
  --color-text-muted: var(--primitive-slate-400);

  /* Brand Colors */
  --color-brand-primary: var(--primitive-blue-500);
  --color-brand-primary-hover: var(--primitive-blue-600);
  --color-brand-primary-active: 29 78 216;
  --color-brand-secondary: var(--primitive-slate-500);
  --color-brand-secondary-hover: var(--primitive-slate-600);
  --color-brand-accent: var(--primitive-blue-500);

  /* Border Colors */
  --color-border-primary: var(--primitive-slate-200);
  --color-border-secondary: var(--primitive-slate-300);
  --color-border-focus: var(--primitive-blue-500);

  /* Feedback Colors */
  --color-success: var(--primitive-green-500);
  --color-warning: var(--primitive-yellow-500);
  --color-error: var(--primitive-red-500);
  --color-info: var(--primitive-blue-500);

  /* Additional Colors */
  --color-highlight: 254 243 199;
  --color-shadow: 0 0 0;

  /* macOS Traffic Light Primitives */
  --primitive-macos-red: 255 95 87;
  --primitive-macos-red-hover: 255 59 48;
  --primitive-macos-yellow: 255 189 46;
  --primitive-macos-yellow-hover: 255 149 0;
  --primitive-macos-green: 40 202 66;
  --primitive-macos-green-hover: 0 200 77;

  /* Effects */
  --shadow-sm: 0 1px 2px 0 rgb(var(--color-shadow) / 0.05);
  --shadow-base: 0 1px 3px 0 rgb(var(--color-shadow) / 0.1), 0 1px 2px 0 rgb(var(--color-shadow) / 0.06);
  --shadow-lg: 0 10px 15px -3px rgb(var(--color-shadow) / 0.1), 0 4px 6px -2px rgb(var(--color-shadow) / 0.05);

  /* Legacy aliases for backward compatibility */
  --color-primary: var(--color-brand-primary);
  --color-primary-hover: var(--color-brand-primary-hover);
  --color-primary-active: var(--color-brand-primary-active);
  --color-secondary: var(--color-brand-secondary);
  --color-secondary-hover: var(--color-brand-secondary-hover);
  --color-secondary-active: var(--color-brand-secondary);
  --color-accent: var(--color-brand-accent);
}

/* ==========================================
   DARK MODE OVERRIDES (Only Changed Values)
   ========================================== */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) {
    /* Surface Colors */
    --color-bg-primary: var(--primitive-slate-950);
    --color-bg-secondary: var(--primitive-slate-900);
    --color-bg-tertiary: var(--primitive-slate-800);
    --color-bg-quaternary: var(--primitive-slate-700);

    /* Text Colors */
    --color-text-primary: var(--primitive-slate-50);
    --color-text-secondary: var(--primitive-slate-400);
    --color-text-tertiary: var(--primitive-slate-500);
    --color-text-muted: var(--primitive-slate-600);

    /* Brand Colors */
    --color-brand-primary: var(--primitive-blue-400);
    --color-brand-accent: var(--primitive-blue-400);

    /* Border Colors */
    --color-border-primary: var(--primitive-slate-700);
    --color-border-secondary: var(--primitive-slate-600);

    /* Enhanced Shadows for Dark Mode */
    --shadow-sm: 0 1px 2px 0 rgb(var(--color-shadow) / 0.3);
    --shadow-base: 0 1px 3px 0 rgb(var(--color-shadow) / 0.4), 0 1px 2px 0 rgb(var(--color-shadow) / 0.3);
    --shadow-lg: 0 10px 15px -3px rgb(var(--color-shadow) / 0.4), 0 4px 6px -2px rgb(var(--color-shadow) / 0.3);
  }
}

/* Manual Dark Mode Override - Consolidated with media query above */

/* Manual light mode overrides removed - handled by theme engine semantic system */

/* ==========================================
   TAILWIND THEME MAPPING (Works with Theme Engine)
   ========================================== */
@theme {
  /* ==========================================
     DIRECT THEME VARIABLE MAPPING
     The theme engine sets CSS variables that we use directly
     This ensures the Golden Rule: changing themes only requires CSS variable updates
     ========================================== */

  /* Core Surface Colors - Map semantic tokens to Tailwind utilities */
  --color-background: rgb(var(--color-bg-primary));
  --color-foreground: rgb(var(--color-text-primary));
  --color-surface: rgb(var(--color-bg-secondary));
  --color-surface-elevated: rgb(var(--color-bg-primary));
  --color-muted: rgb(var(--color-bg-tertiary));
  --color-muted-foreground: rgb(var(--color-text-secondary));

  /* Brand Colors - Map semantic tokens to Tailwind utilities */
  --color-primary: rgb(var(--color-brand-primary));
  --color-primary-hover: rgb(var(--color-brand-primary-hover));
  --color-primary-active: rgb(var(--color-brand-primary-active));
  --color-secondary: rgb(var(--color-brand-secondary));
  --color-secondary-hover: rgb(var(--color-brand-secondary-hover));
  --color-accent: rgb(var(--color-brand-accent));

  /* Text Colors - Map semantic tokens to Tailwind utilities */
  --color-text-primary: rgb(var(--color-text-primary));
  --color-text-secondary: rgb(var(--color-text-secondary));
  --color-text-tertiary: rgb(var(--color-text-tertiary));
  --color-text-inverse: rgb(var(--color-text-inverse));

  /* Border Colors - Map semantic tokens to Tailwind utilities */
  --color-border: rgb(var(--color-border-primary));
  --color-border-hover: rgb(var(--color-border-secondary));
  --color-border-focus: rgb(var(--color-border-focus));

  /* Feedback Colors - Map semantic tokens to Tailwind utilities */
  --color-success: rgb(var(--color-success));
  --color-warning: rgb(var(--color-warning));
  --color-error: rgb(var(--color-error));
  --color-info: rgb(var(--color-info));

  /* Interactive States - Map semantic tokens to Tailwind utilities */
  --color-ring: rgb(var(--color-brand-accent));
  --color-link: rgb(var(--color-brand-primary));
  --color-link-hover: rgb(var(--color-brand-primary-hover));

  /* Input Elements - Map semantic tokens to Tailwind utilities */
  --color-input-bg: rgb(var(--color-bg-primary));

  /* Additional Colors - Map semantic tokens to Tailwind utilities */
  --color-highlight: rgb(var(--color-highlight));
  --color-overlay: rgb(var(--color-shadow));

  /* Shadows - Direct theme engine mapping */
  --shadow-sm: var(--shadow-sm);
  --shadow-base: var(--shadow-base);
  --shadow-lg: var(--shadow-lg);

  /* macOS-specific shadows using semantic tokens */
  --shadow-macos: 0 10px 40px rgb(var(--color-shadow) / 0.15), 0 4px 12px rgb(var(--color-shadow) / 0.1), 0 0 0 1px rgb(var(--color-shadow) / 0.05);
  --shadow-macos-focused: 0 20px 60px rgb(var(--color-shadow) / 0.2), 0 8px 20px rgb(var(--color-shadow) / 0.15), 0 0 0 1px rgb(var(--color-shadow) / 0.08);
  --shadow-macos-unfocused: 0 8px 32px rgb(var(--color-shadow) / 0.12), 0 4px 12px rgb(var(--color-shadow) / 0.08), 0 0 0 1px rgb(var(--color-shadow) / 0.03);

  /* macOS Colors - Map primitives to theme utilities */
  --color-macos-red: rgb(var(--primitive-macos-red));
  --color-macos-red-hover: rgb(var(--primitive-macos-red-hover));
  --color-macos-yellow: rgb(var(--primitive-macos-yellow));
  --color-macos-yellow-hover: rgb(var(--primitive-macos-yellow-hover));
  --color-macos-green: rgb(var(--primitive-macos-green));
  --color-macos-green-hover: rgb(var(--primitive-macos-green-hover));

  /* macOS backdrop blur */
  --backdrop-macos: blur(20px);
  --backdrop-macos-strong: blur(30px);

  /* macOS animations */
  --animate-macos-window-appear: windowAppear 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --animate-macos-control-appear: controlAppear 0.3s ease-out;

  --font-family-primary: var(--font-family-primary);
  --font-size-base: var(--font-size-base);

  /* Dark mode configuration - use data-theme-mode attribute */
  --dark-mode: '[data-theme-mode="dark"] &';

  /* Window shadow definitions */
  --window-shadow-focused: 0 20px 60px rgba(0, 0, 0, 0.25), 0 8px 20px rgba(0, 0, 0, 0.15);
  --window-shadow-unfocused: 0 10px 40px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* macOS Keyframes */
@keyframes windowAppear {
  0% {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

@keyframes controlAppear {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* ==========================================
   CALCULATOR PLUGIN THEMING
   ========================================== */

/*
   Enhanced theming for the calculator plugin to provide better contrast
   and professional appearance across light and dark modes.
*/

/* Calculator container */
.calculator {
  background-color: var(--color-bg-primary);
  border: 1px solid var(--color-border-primary);
  box-shadow: var(--shadow-lg);
}

/* Calculator display */
.calculator-display {
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  border-bottom: 1px solid var(--color-border-primary);
}

/* Calculator button grid */
.calculator-buttons {
  background-color: var(--color-border-primary);
  gap: 1px;
}

/* Calculator buttons - Base styling */
.calculator-button {
  border: none;
  transition: all var(--transition-fast);
  font-weight: 500;
  position: relative;
  overflow: hidden;
}

/* Number buttons */
.calculator-button.number {
  background-color: var(--color-muted);
  color: var(--color-text-primary);
}

.calculator-button.number:hover {
  background-color: var(--color-bg-tertiary);
  transform: translateY(-1px);
  box-shadow: var(--shadow-base);
}

.calculator-button.number:active {
  transform: translateY(0);
  box-shadow: none;
}

/* Operation buttons */
.calculator-button.operation {
  background-color: var(--color-brand-primary);
  color: var(--color-text-inverse);
}

.calculator-button.operation:hover {
  background-color: var(--color-brand-primary-hover);
  transform: translateY(-1px);
  box-shadow: var(--shadow-base);
}

.calculator-button.operation.active {
  background-color: var(--color-bg-secondary);
  color: var(--color-brand-primary);
  border: 2px solid var(--color-brand-primary);
}

/* Function buttons (AC, C, ±, %) */
.calculator-button.function {
  background-color: var(--color-surface);
  color: var(--color-text-primary);
}

.calculator-button.function:hover {
  background-color: var(--color-bg-tertiary);
  transform: translateY(-1px);
  box-shadow: var(--shadow-base);
}

/* Dark mode calculator enhancements */
[data-theme="dark"] .calculator {
  background-color: var(--color-bg-tertiary);
  border-color: var(--color-border-secondary);
}

[data-theme="dark"] .calculator-display {
  background-color: var(--color-bg-tertiary);
  color: rgb(var(--color-text-primary));
}

[data-theme="dark"] .calculator-button.number {
  background-color: var(--color-bg-secondary);
  color: rgb(var(--color-text-primary));
}

[data-theme="dark"] .calculator-button.number:hover {
  background-color: var(--color-bg-quaternary);
}

[data-theme="dark"] .calculator-button.function {
  background-color: var(--color-surface);
  color: rgb(var(--color-text-primary));
}

[data-theme="dark"] .calculator-button.function:hover {
  background-color: var(--color-bg-quaternary);
}

[data-theme="dark"] .calculator-button.operation {
  background-color: rgb(var(--color-warning));
  color: rgb(var(--color-text-inverse));
}

[data-theme="dark"] .calculator-button.operation:hover {
  background-color: rgb(var(--color-warning));
  opacity: 0.8;
}

[data-theme="dark"] .calculator-button.operation.active {
  background-color: var(--color-bg-secondary);
  color: rgb(var(--color-warning));
  border-color: rgb(var(--color-warning));
}

/* Light mode calculator enhancements - Softer colors */
[data-theme="light"] .calculator {
  background-color: var(--color-bg-primary);
  border-color: var(--color-border-primary);
}

[data-theme="light"] .calculator-display {
  background-color: var(--color-bg-primary);
  color: rgb(var(--color-text-primary));
}

[data-theme="light"] .calculator-button.number {
  background-color: var(--color-bg-secondary);
  color: rgb(var(--color-text-primary));
}

[data-theme="light"] .calculator-button.number:hover {
  background-color: var(--color-bg-tertiary);
}

[data-theme="light"] .calculator-button.function {
  background-color: var(--color-bg-tertiary);
  color: rgb(var(--color-text-secondary));
}

[data-theme="light"] .calculator-button.function:hover {
  background-color: var(--color-bg-quaternary);
}

[data-theme="light"] .calculator-button.operation {
  background-color: rgb(var(--color-warning));
  color: rgb(var(--color-text-inverse));
}

[data-theme="light"] .calculator-button.operation:hover {
  background-color: rgb(var(--color-warning));
  opacity: 0.8;
}

[data-theme="light"] .calculator-button.operation.active {
  background-color: rgb(var(--color-highlight));
  color: rgb(var(--color-warning));
  border-color: rgb(var(--color-warning));
}

/* ==========================================
   SETTINGS PLUGIN THEMING
   ========================================== */

/*
   Enhanced theming for the settings plugin to provide better contrast
   and more consistent colors across light and dark modes.
*/

/* Settings Sidebar - Enhanced theming */
.settings-sidebar {
  background-color: var(--color-bg-secondary);
  border-right: 1px solid var(--color-border-primary);
}

/* Dark mode settings sidebar - much darker */
[data-theme="dark"] .settings-sidebar {
  background-color: #0f172a; /* Much darker than default secondary */
  border-right-color: #1e2937;
}

/* Light mode settings sidebar - consistent light color */
[data-theme="light"] .settings-sidebar {
  background-color: #f8fafc; /* Clean light gray */
  border-right-color: #e2e8f0;
}

/* Settings sidebar navigation items */
.settings-nav-item {
  color: var(--color-text-primary);
  transition: all var(--transition-normal);
}

.settings-nav-item:hover {
  background-color: var(--color-bg-tertiary);
}

.settings-nav-item.active {
  background-color: var(--color-accent);
  color: var(--color-text-inverse);
}

/* Dark mode navigation adjustments */
[data-theme="dark"] .settings-nav-item:hover {
  background-color: #1e2937; /* Darker hover for dark mode */
}

[data-theme="dark"] .settings-nav-item.active {
  background-color: #3b82f6; /* Proper blue accent for dark mode */
}

/* Light mode navigation adjustments */
[data-theme="light"] .settings-nav-item:hover {
  background-color: #f1f5f9; /* Lighter hover for light mode */
}

[data-theme="light"] .settings-nav-item.active {
  background-color: #3b82f6; /* Consistent blue accent */
}

/* Settings content area */
.settings-content {
  background-color: var(--color-bg-primary);
  border-bottom: 1px solid var(--color-border-primary);
}

/* Settings input fields */
.settings-input {
  background-color: var(--color-muted);
  border: 1px solid var(--color-border-primary);
  color: var(--color-text-primary);
}

.settings-input:focus {
  border-color: var(--color-border-focus);
  box-shadow: 0 0 0 1px var(--color-border-focus);
}

/* ==========================================
   WINDOW COMPONENT THEMING
   ========================================== */

/*
   Apply theme-aware colors to window components.
   This ensures windows have deeply integrated background colors
   that adapt to theme changes via the Golden Rule.
*/

/* Main window container - Use theme engine variables directly */
.window-frame,
.window-manager .window {
  background-color: var(--color-bg-primary);
  border-color: var(--color-border-primary);
  color: var(--color-text-primary);
  box-shadow: var(--window-shadow-unfocused);
  transition: all var(--transition-normal);
}

.window-content {
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
}

/* Window chrome/titlebar - Use semantic surface colors */
.window-chrome,
.window-manager .window-chrome {
  background-color: var(--color-bg-secondary);
  border-color: var(--color-border-primary);
  color: var(--color-text-primary);
}

/* Active/focused window state - Enhanced contrast */
.window-frame[data-focused="true"],
.window-manager .window[data-focused="true"] {
  background-color: var(--color-bg-primary);
  border-color: var(--color-border-focus);
  box-shadow: var(--window-shadow-focused);
}

/* Inactive/unfocused window state - Slightly dimmed */
.window-frame:not([data-focused="true"]),
.window-manager .window:not([data-focused="true"]) {
  background-color: var(--color-bg-secondary);
  border-color: var(--color-border-primary);
  opacity: 0.95;
}

/* Window hover states */
.window-frame:hover,
.window-manager .window:hover {
  background-color: var(--color-bg-primary);
  border-color: var(--color-border-focus);
}

/* macOS traffic light buttons - Theme-aware backgrounds */
.traffic-light-button {
  background-color: var(--color-bg-primary);
  border-color: var(--color-border-primary);
  transition: all var(--transition-fast);
}

.traffic-light-button:hover {
  border-color: var(--color-border-focus);
  transform: scale(1.1);
}

/* Traffic light button specific colors */
.traffic-light-close {
  background-color: var(--color-macos-red);
}

.traffic-light-close:hover {
  background-color: var(--color-macos-red-hover);
}

.traffic-light-minimize {
  background-color: var(--color-macos-yellow);
}

.traffic-light-minimize:hover {
  background-color: var(--color-macos-yellow-hover);
}

.traffic-light-maximize {
  background-color: var(--color-macos-green);
}

.traffic-light-maximize:hover {
  background-color: var(--color-macos-green-hover);
}

/* ==========================================
   THEME ENGINE INTEGRATION
   ========================================== */

/*
   This section ensures compatibility with the theme engine.
   The theme engine sets CSS variables in hex format, but our Tailwind system
   needs them in specific formats. This section handles the conversion.
*/

/* Legacy fallback values */
:root {
  --border-radius-base: 0.25rem;
  --font-family-primary: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-size-base: 1rem;
  --taskbar-height: 48px;
  --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
  --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);

  /* Dock Theming Variables */
  --dock-backdrop: blur(20px);
  --dock-padding: 16px;
  --dock-gap: 4px;
  --dock-radius: 16px;
  --dock-item-size: 56px;
  --dock-item-radius: 14px;
  --dock-icon-size: 38px;
  --dock-transition: 250ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --dock-magnification-scale: 1.6;
  --dock-magnification-range: 3;
  --dock-magnification-spread: 80px;

  /* Legacy aliases for backward compatibility */
  --bg-primary: var(--color-bg-primary);
  --bg-secondary: var(--color-bg-secondary);
  --bg-tertiary: var(--color-bg-tertiary);
  --text-primary: var(--color-text-primary);
  --text-secondary: var(--color-text-secondary);
  --border-color: var(--color-border-primary);
  --accent-color: var(--color-accent);
  --shadow-light: var(--shadow-sm);
  --shadow-medium: var(--shadow-base);
  --shadow-heavy: var(--shadow-lg);
  --window-shadow: var(--shadow-lg);
}

/* Global Transitions - Restored for smooth window movement */
* {
  transition: background-color var(--transition-normal),
              border-color var(--transition-normal),
              color var(--transition-normal),
              box-shadow var(--transition-normal),
              transform var(--transition-fast);
}

/* macOS-style Scrollbar Styling - Truly Thin */
.scrollbar-thin {
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.15) transparent;
}

.scrollbar-thin::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

.scrollbar-thin::-webkit-scrollbar-track {
  background: transparent;
  border: none;
}

.scrollbar-thin::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.15);
  border-radius: 2px;
  border: 1px solid transparent;
  background-clip: content-box;
  transition: background-color 0.15s ease;
}

.scrollbar-thin::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.3);
  background-clip: content-box;
}

.scrollbar-thin::-webkit-scrollbar-thumb:active {
  background: rgba(0, 0, 0, 0.4);
  background-clip: content-box;
}

.scrollbar-thin::-webkit-scrollbar-corner {
  background: transparent;
}

/* Dark mode scrollbars */
[data-theme="dark"] .scrollbar-thin {
  scrollbar-color: rgba(255, 255, 255, 0.25) transparent;
}

[data-theme="dark"] .scrollbar-thin::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.25);
  background-clip: content-box;
}

[data-theme="dark"] .scrollbar-thin::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.4);
  background-clip: content-box;
}

[data-theme="dark"] .scrollbar-thin::-webkit-scrollbar-thumb:active {
  background: rgba(255, 255, 255, 0.5);
  background-clip: content-box;
}

/* Dark mode for macOS-style windows - Now handled by Tailwind dark: utilities */

/* Window Animations - Now handled by Tailwind classes */

/* Desktop Icon Animations */
.desktop-icon {
  position: relative;
  transition: all var(--transition-fast);
  cursor: pointer;
}

.desktop-icon:hover {
  transform: translateY(-2px) scale(1.05);
}

.desktop-icon:hover .icon-label {
  background: var(--color-accent);
  color: var(--color-text-inverse);
  transform: translateY(-2px);
}

.desktop-icon:active {
  transform: translateY(0) scale(0.98);
}

.desktop-icon.selected {
  background: var(--color-accent);
  color: white;
}

.desktop-icon.selected .icon-label {
  background: var(--accent-hover);
}

.icon-label {
  transition: all var(--transition-fast);
  border-radius: 4px;
  padding: 2px 8px;
  margin-top: 4px;
  text-align: center;
  font-size: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Taskbar Enhancements */
.taskbar {
  height: var(--taskbar-height);
  background: var(--color-bg-secondary);
  border-top: 1px solid var(--color-border-primary);
  backdrop-filter: blur(10px);
  animation: slideUp var(--transition-normal) ease-out;
}

.taskbar-item {
  transition: all var(--transition-fast);
  position: relative;
  overflow: hidden;
}

.taskbar-item:hover {
  background: var(--color-bg-tertiary);
  transform: translateY(-2px);
}

.taskbar-item.active {
  background: var(--color-accent);
  color: var(--color-text-inverse);
}

.taskbar-item.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--accent-hover);
  animation: slideIn var(--transition-fast) ease-out;
}

.taskbar-item::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  transition: width var(--transition-normal), height var(--transition-normal);
}

.taskbar-item:active::before {
  width: 100px;
  height: 100px;
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    transform: scaleX(0);
  }
  to {
    transform: scaleX(1);
  }
}

/* Focus Indicators and Accessibility */
:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
  border-radius: 4px;
}

button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.2);
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --border-color: #000000;
    --text-primary: #000000;
    --bg-primary: #ffffff;
  }
  
  [data-theme="dark"] {
    --border-color: #ffffff;
    --text-primary: #ffffff;
    --bg-primary: #000000;
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms;
    animation-iteration-count: 1;
    transition-duration: 0.01ms;
  }
}

/* Loading Animations */
.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--color-bg-tertiary);
  border-top: 3px solid var(--color-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.loading-dots {
  display: inline-flex;
  gap: 4px;
}

.loading-dots span {
  width: 8px;
  height: 8px;
  background: var(--color-accent);
  border-radius: 50%;
  animation: bounce 1.4s ease-in-out infinite both;
}

.loading-dots span:nth-child(1) { animation-delay: -0.32s; }
.loading-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes bounce {
  0%, 80%, 100% {
    transform: scale(0);
  }
  40% {
    transform: scale(1);
  }
}

/* Window Snapping Visual Feedback */
.snap-zone {
  position: fixed;
  background: var(--color-accent);
  opacity: 0.2;
  border: 2px dashed var(--color-accent);
  pointer-events: none;
  transition: all var(--transition-fast);
  z-index: 1000;
}

.snap-zone.active {
  opacity: 0.4;
  background: var(--color-accent);
  animation: snapZonePulse 500ms ease-in-out infinite;
}

@keyframes snapZonePulse {
  0%, 100% {
    opacity: 0.4;
  }
  50% {
    opacity: 0.6;
  }
}

/* Ghost Window Effects for Dragging */
.ghost-window {
  position: fixed;
  opacity: 0.6;
  transform: scale(0.95);
  pointer-events: none;
  z-index: 9999;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
  border: 2px solid var(--color-accent);
  transition: opacity var(--transition-fast), transform var(--transition-fast);
}

/* Context Menu Animations */
.context-menu {
  animation: contextMenuOpen var(--transition-fast) ease-out;
  transform-origin: top left;
}

@keyframes contextMenuOpen {
  0% {
    opacity: 0;
    transform: scale(0.95) translateY(-10px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* Tooltip Animations */
.tooltip {
  animation: tooltipFadeIn var(--transition-fast) ease-out;
}

@keyframes tooltipFadeIn {
  0% {
    opacity: 0;
    transform: translateY(4px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Notification Animations */
.notification {
  animation: notificationSlideIn var(--transition-normal) ease-out;
}

.notification.removing {
  animation: notificationSlideOut var(--transition-normal) ease-out forwards;
}

@keyframes notificationSlideIn {
  0% {
    transform: translateX(100%);
    opacity: 0;
  }
  100% {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes notificationSlideOut {
  0% {
    transform: translateX(0);
    opacity: 1;
  }
  100% {
    transform: translateX(100%);
    opacity: 0;
  }
}

/* Button Hover Effects */
.btn {
  transition: opacity var(--transition-fast);
}

.btn:hover {
  opacity: 0.8;
}

/* Input Field Focus Effects */
.input-field {
  transition: all var(--transition-fast);
  border: 1px solid var(--color-border-primary);
}

.input-field:focus {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
  transform: translateY(-1px);
}

/* Progress Bar Animations */
.progress-bar {
  position: relative;
  overflow: hidden;
}

.progress-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  animation: progressShine 2s linear infinite;
}

@keyframes progressShine {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* Modal Backdrop */
.modal-backdrop {
  animation: fadeIn var(--transition-normal) ease-out;
}

.modal-content {
  animation: modalSlideIn var(--transition-slow) cubic-bezier(0.34, 1.56, 0.64, 1);
}



@keyframes fadeIn {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}

@keyframes modalSlideIn {
  0% {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* ==========================================
   DOCK COMPONENT THEMING
   ========================================== */

/* Main Dock Container - Higher specificity */
.dock {
  position: fixed;
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999; /* Always behind windows */
  padding: 8px;
  transition: all var(--dock-transition);
}

/* Dock Background - Transparent with backdrop blur */
.dock .dock-background {
  background: rgb(var(--color-bg-primary) / 0.7);
  backdrop-filter: var(--dock-backdrop);
  border-radius: var(--dock-radius);
  padding: var(--dock-padding);
  box-shadow: var(--shadow-lg);
  border: 1px solid rgb(var(--color-border-primary) / 0.3);
  display: flex;
  align-items: center;
  gap: var(--dock-gap);
  transition: all var(--dock-transition), gap var(--dock-transition);
}

.dock .dock-background:hover {
  background: rgb(var(--color-bg-primary) / 0.8);
  border-color: rgb(var(--color-border-secondary) / 0.4);
}

/* Dock Items - Use relative positioning with flexbox */
.dock-background .dock-item {
  position: relative;
  width: var(--dock-item-size);
  height: var(--dock-item-size);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: var(--dock-item-radius);
  transition: transform var(--dock-transition), background var(--transition-normal);
  transform-origin: center bottom;
  transform: translateZ(0);
  will-change: transform;
  margin: 0 8px;
  background: transparent;
}

.dock-background .dock-item:hover {
  background: var(--color-bg-tertiary);
  border-color: var(--color-border-focus);
}

.dock-background .dock-item.active {
  background: var(--color-accent);
  border-color: var(--color-border-focus);
}

.dock-item.running::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 4px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* Dock Icons - Theme-aware using theme engine variables */
.dock-item-icon {
  font-size: var(--dock-icon-size);
  line-height: 1;
  transition: transform var(--dock-transition), color var(--dock-transition);
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  pointer-events: none;
  color: rgb(var(--color-text-primary)); /* Use primary text color */
}

/* Dock icon states - Theme-aware */
.dock-item:hover .dock-item-icon {
  color: rgb(var(--color-text-tertiary)); /* Dimmer color for hover */
}

.dock-item.active .dock-item-icon {
  color: rgb(var(--color-text-secondary)); /* Secondary color for active state */
}

/* Icon adjustments now handled by semantic token system - no manual overrides needed */

/* Dock Magnification Classes */
.dock-background .dock-item.dock-item-scale-1 { transform: translateZ(0) scale(1.0); }
.dock-background .dock-item.dock-item-scale-1-1 { transform: translateZ(0) scale(1.1); }
.dock-background .dock-item.dock-item-scale-1-2 { transform: translateZ(0) scale(1.2); }
.dock-background .dock-item.dock-item-scale-1-3 { transform: translateZ(0) scale(1.3); }
.dock-background .dock-item.dock-item-scale-1-4 { transform: translateZ(0) scale(1.4); }
.dock-background .dock-item.dock-item-scale-1-5 { transform: translateZ(0) scale(1.5); }
.dock-background .dock-item.dock-item-scale-1-6 { transform: translateZ(0) scale(1.6); }
.dock-background .dock-item.dock-item-scale-1-7 { transform: translateZ(0) scale(1.7); }
.dock-background .dock-item.dock-item-scale-1-8 { transform: translateZ(0) scale(1.8); }

/* Enhanced magnification transitions */
.dock-background .dock-item {
  transition: transform var(--dock-transition);
}

/* Dock Indicator */
.dock-indicator {
  position: absolute;
  bottom: -2px;
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 4px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.dock-indicator.pulse {
  animation: dockIndicatorPulse 2s infinite;
}

@keyframes dockIndicatorPulse {
  0%, 100% {
    opacity: 1;
    transform: translateX(-50%) scale(1);
  }
  50% {
    opacity: 0.6;
    transform: translateX(-50%) scale(1.2);
  }
}

/* Dock Badge */
.dock-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  background: rgb(var(--color-error));
  color: rgb(var(--color-text-inverse));
  font-size: 10px;
  font-weight: 600;
  padding: 2px 4px;
  border-radius: 8px;
  min-width: 16px;
  text-align: center;
  box-shadow: var(--shadow-sm);
  z-index: 10;
}

/* Dock Tooltip - Theme-aware */
.dock-tooltip {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 8px;
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border-primary);
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 12px;
  white-space: nowrap;
  pointer-events: none;
  animation: tooltipFadeIn var(--transition-fast) ease-out;
  min-width: 120px;
  max-width: 200px;
  z-index: 1000;
  box-shadow: var(--shadow-base);
}

.dock-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 4px solid transparent;
  border-top-color: var(--color-bg-secondary);
}

.dock-tooltip-name {
  font-weight: 500;
}

.dock-tooltip-state {
  font-size: 9px;
  opacity: 0.5;
  margin-top: 1px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.dock-tooltip-status {
  font-size: 10px;
  opacity: 0.7;
  margin-top: 2px;
}

.dock-tooltip-events {
  font-size: 8px;
  opacity: 0.6;
  margin-top: 1px;
  text-transform: lowercase;
  color: rgba(255, 255, 255, 0.8);
}

.dock-tooltip-debug {
  font-size: 7px;
  opacity: 0.5;
  margin-top: 2px;
  font-family: monospace;
  color: rgba(255, 255, 255, 0.6);
  border-top: 1px solid rgba(255, 255, 255, 0.2);
  padding-top: 2px;
}

/* Dock Loading States */
.dock-launching-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.2);
  border-radius: var(--dock-item-radius);
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(2px);
}

.dock-launching-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top: 2px solid rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  animation: dockSpinner 1s linear infinite;
}

@keyframes dockSpinner {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Dock Error States */
.dock-error-indicator {
  position: absolute;
  top: -2px;
  right: -2px;
  font-size: 10px;
  background: rgba(255, 59, 48, 0.9);
  border-radius: 50%;
  width: 14px;
  height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  cursor: pointer;
}

/* Dock State-based Styling */
.dock-item[data-fsm-state="idle"] {
  opacity: 0.8;
}

.dock-item[data-fsm-state="launching"] {
  background: rgba(0, 122, 255, 0.2);
  animation: dockItemLaunching 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

.dock-item[data-fsm-state="running"] {
  background: rgba(255, 255, 255, 0.1);
}

.dock-item[data-fsm-state="active"] {
  background: rgba(52, 199, 89, 0.3);
  box-shadow: 0 0 20px rgba(52, 199, 89, 0.2);
}

.dock-item[data-fsm-state="minimized"] {
  background: rgba(255, 149, 0, 0.2);
  opacity: 0.8;
  border: 1px dashed rgba(255, 149, 0, 0.4);
}

.dock-item[data-fsm-state="quitting"] {
  background: rgba(255, 59, 48, 0.2);
  opacity: 0.6;
  animation: dockItemQuitting 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Dock Animations */
@keyframes dockItemLaunching {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(0.95); opacity: 0.8; }
  100% { transform: scale(1); opacity: 1; }
}

@keyframes dockItemQuitting {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(0.9); opacity: 0.6; }
}

@keyframes dockItemActive {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Dock Diagnostics (Dev Mode) */
.dock-diagnostics {
  position: absolute;
  top: -25px;
  right: 8px;
  display: flex;
  gap: 4px;
  background: rgba(0, 0, 0, 0.7);
  padding: 2px 6px;
  border-radius: 8px;
  font-size: 10px;
  color: white;
  font-family: monospace;
  backdrop-filter: blur(10px);
  z-index: 1001;
}

.dock-diagnostic-item {
  cursor: pointer;
  padding: 1px 3px;
  border-radius: 3px;
  transition: background var(--transition-fast);
}

.dock-diagnostic-item:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* FSM Inspector Button (Dev Mode) */
.dock-fsm-inspector {
  position: absolute;
  top: -2px;
  left: -2px;
  font-size: 8px;
  background: rgba(0, 122, 255, 0.8);
  border-radius: 50%;
  width: 12px;
  height: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 11;
  transition: all var(--transition-fast);
}

.dock-fsm-inspector:hover {
  background: rgba(0, 122, 255, 1);
  transform: scale(1.2);
}

/* Dark Mode Support - Uses CSS variables from above */

/* Responsive Design */
@media (max-width: 768px) {
  .dock {
    bottom: 4px;
    padding: 4px;
  }

  .dock-background {
    padding: 8px;
    gap: 6px;
  }

  .dock-item {
    width: 44px;
    height: 44px;
  }

  .dock-item-icon {
    font-size: 28px;
  }

  .dock-launching-spinner {
    width: 16px;
    height: 16px;
    border-width: 1.5px;
  }

  /* Hide dev tools on mobile */
  .dock-fsm-inspector,
  .dock-diagnostics {
    display: none;
  }
}

/* High DPI Support */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  .dock-item-icon {
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
  }
}

/* Accessibility */
@media (prefers-reduced-motion: reduce) {
  .dock,
  .dock-background,
  .dock-item,
  .dock-item-icon {
    transition: none;
    animation: none;
  }

  .dock-item-scale-1,
  .dock-item-scale-1-1,
  .dock-item-scale-1-2,
  .dock-item-scale-1-3,
  .dock-item-scale-1-4,
  .dock-item-scale-1-5,
  .dock-item-scale-1-6,
  .dock-item-scale-1-7,
  .dock-item-scale-1-8 {
    transform: scale(1);
  }
}

/* Focus Management */
.dock-item:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.2);
}

.dock-fsm-inspector:focus-visible {
  outline: 1px solid white;
  outline-offset: 1px;
}

/* Performance Optimizations */


.dock-item {
  contain: layout style;
  transform: translateZ(0); /* GPU acceleration */
}

/* Debug Mode Styles (only visible in development) - REMOVED TO FIX ISSUES */
/* :root[data-debug="true"] .dock-item::before { ... } */